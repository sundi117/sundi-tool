# 数据库字典生成工具 - 构建说明

本文档将指导您如何将数据库字典生成工具打包为独立的可执行文件（EXE）。

## 📋 前置要求

### 1. Python 环境
- **Python 版本**: 3.7 或更高版本
- **安装方式**: 从 [Python官网](https://www.python.org/downloads/) 下载并安装
- **注意事项**: 安装时请勾选 "Add Python to PATH" 选项

### 2. 检查 Python 安装
打开命令提示符（CMD）或 PowerShell，执行以下命令：
```bash
python --version
pip --version
```
如果命令执行成功并显示版本号，说明 Python 已正确安装。

## 🚀 快速构建（推荐方式）

### 方式一：使用自动化脚本（最简单）

1. **进入项目目录**
   ```bash
   cd 数据库字典生成工具
   ```

2. **运行构建脚本**
   - 直接双击 `build_exe.bat` 文件
   - 或在命令行中执行：
     ```bash
     build_exe.bat
     ```

3. **等待构建完成**
   - 脚本会自动安装依赖
   - 自动使用 PyInstaller 打包
   - 构建完成后，可执行文件位于 `dist\数据库字典生成工具.exe`

## 📦 手动构建（高级方式）

如果您希望自定义构建选项或遇到问题，可以手动执行构建步骤：

### 步骤 1: 安装依赖

在项目目录下执行：
```bash
pip install -r requirements.txt
```

这将会安装以下依赖：
- `pymysql>=1.0.2` - MySQL 数据库连接
- `pyinstaller>=5.0.0` - 打包工具
- `ttkbootstrap>=1.10.1` - GUI 界面库
- `python-docx>=0.8.11` - Word 文档生成

### 步骤 2: 使用 PyInstaller 打包

#### 方法 A：使用命令行参数（简单）

```bash
pyinstaller --onefile --windowed --name "数据库字典生成工具" --icon=NONE --hidden-import=ttkbootstrap --hidden-import=docx --collect-all=ttkbootstrap generator_md.py
```

参数说明：
- `--onefile`: 打包成单个可执行文件
- `--windowed`: 不显示控制台窗口（GUI 应用）
- `--name`: 指定生成的可执行文件名称
- `--icon`: 指定图标文件（NONE 表示不使用图标）
- `--hidden-import`: 指定需要包含但 PyInstaller 可能遗漏的模块
- `--collect-all`: 收集指定包的所有资源文件
- `generator_md.py`: 主程序文件

#### 方法 B：使用 spec 文件（推荐，可自定义）

如果您已有 `数据库字典生成工具.spec` 文件：

```bash
pyinstaller 数据库字典生成工具.spec
```

使用 spec 文件的好处：
- 配置更清晰，易于维护
- 可以精确控制打包选项
- 支持更复杂的打包需求

### 步骤 3: 获取可执行文件

构建完成后，可执行文件将位于：
```
dist\数据库字典生成工具.exe
```

## 📁 构建产物说明

构建完成后会生成以下目录和文件：

```
数据库字典生成工具/
├── dist/                      # 最终的可执行文件目录
│   └── 数据库字典生成工具.exe  # 可执行文件（可直接运行）
├── build/                     # 临时构建文件（可删除）
└── *.spec                     # PyInstaller 配置文件（如果使用 spec 方式）
```

**注意**: `build` 目录和 `dist` 目录中的其他文件可以删除，只需要保留 `dist\数据库字典生成工具.exe` 即可。

## 🔧 常见问题解决

### 问题 1: 提示 "pip 不是内部或外部命令"

**解决方法**:
1. 确保 Python 已正确安装并添加到 PATH
2. 尝试使用 `python -m pip` 代替 `pip`
3. 重新安装 Python 并勾选 "Add Python to PATH"

### 问题 2: 打包后的 exe 文件无法运行，提示缺少模块

**解决方法**:
1. 检查 `requirements.txt` 中的所有依赖是否都已安装
2. 使用 `--hidden-import` 参数添加缺失的模块：
   ```bash
   pyinstaller --hidden-import=模块名 generator_md.py
   ```
3. 如果是 ttkbootstrap 相关的问题，使用 `--collect-all=ttkbootstrap` 确保收集所有资源

### 问题 3: 打包后的 exe 文件体积过大

**解决方法**:
1. 使用 `--exclude-module` 排除不需要的模块
2. 检查是否有不必要的依赖
3. 使用 UPX 压缩（已在 spec 文件中启用）

### 问题 4: 打包过程很慢或卡住

**解决方法**:
1. 关闭杀毒软件的实时保护（可能会扫描打包过程）
2. 确保有足够的磁盘空间
3. 尝试在管理员权限下运行

### 问题 5: 生成的 exe 运行时出现错误

**解决方法**:
1. 先测试 Python 脚本本身是否正常运行：
   ```bash
   python generator_md.py
   ```
2. 如果是打包后的问题，可以尝试添加 `--console` 参数查看错误信息：
   ```bash
   pyinstaller --onefile --console --name "数据库字典生成工具" generator_md.py
   ```
3. 检查是否所有必要的资源文件都已包含

## 📝 自定义构建选项

### 添加图标

如果您有图标文件（.ico 格式），可以替换 `--icon=NONE` 参数：

```bash
pyinstaller --icon=your_icon.ico generator_md.py
```

或在 spec 文件中修改：
```python
icon='your_icon.ico',  # 替换 'NONE'
```

### 显示控制台窗口（用于调试）

如果需要在运行时显示控制台窗口查看日志，将 `--windowed` 改为 `--console`：

```bash
pyinstaller --onefile --console generator_md.py
```

### 减小文件体积

1. 使用 UPX 压缩（已在 spec 文件中启用 `upx=True`）
2. 排除不必要的模块：
   ```bash
   pyinstaller --exclude-module=不需要的模块名 generator_md.py
   ```

## ✅ 验证构建结果

构建完成后，建议进行以下验证：

1. **文件完整性**: 确认 `dist\数据库字典生成工具.exe` 文件存在且大小合理
2. **功能测试**: 在干净的 Windows 环境中运行 exe 文件，测试所有功能
3. **依赖检查**: 确认在没有安装 Python 的机器上也能正常运行

## 📞 技术支持

如果遇到其他问题，请检查：
- Python 版本是否符合要求
- 所有依赖是否已正确安装
- PyInstaller 版本是否 >= 5.0.0
- 系统环境变量配置是否正确

## 📄 许可证

请参考项目根目录的许可证文件。

---

**最后更新**: 2025年1月
